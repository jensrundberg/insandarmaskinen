/*!
* @author [object Object]
* @version 1.13.0
* @url http://sean.is/poppin/tags
* @license MIT
* @description Taggle is a dependency-less tagging library
*/
!function(a,b){"use strict";var c="Taggle";"function"==typeof define&&define.amd?define([],function(){var d=b();return a[c]=d,d}):"object"==typeof module&&module.exports?module.exports=a[c]=b():a[c]=b()}(this,function(){"use strict";function a(){for(var a=arguments[0],b=1,c=arguments.length;b<c;b++){var d=arguments[b];for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a}function b(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)}function c(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}function d(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null}function e(a){return a.replace(/^\s+|\s+$/g,"")}function f(a,b){window.attachEvent&&!window.addEventListener?a.innerText=b:a.textContent=b}var g=function(){},h=function(){return!0},i=8,j=188,k=9,l=13,m={additionalTagClasses:"",allowDuplicates:!1,saveOnBlur:!1,clearOnBlur:!0,duplicateTagClass:"",containerFocusClass:"active",focusInputOnContainerClick:!0,hiddenInputName:"taggles[]",tags:[],delimeter:",",delimiter:"",attachTagId:!1,allowedTags:[],disallowedTags:[],maxTags:null,tabIndex:1,placeholder:"Enter tags...",submitKeys:[j,k,l],preserveCase:!1,inputFormatter:g,tagFormatter:g,onBeforeTagAdd:g,onTagAdd:g,onBeforeTagRemove:h,onTagRemove:g},n=function(b,c){this.settings=a({},m,c),this.measurements={container:{rect:null,style:null,padding:null}},this.container=b,this.tag={values:[],elements:[]},this.list=document.createElement("ul"),this.inputLi=document.createElement("li"),this.input=document.createElement("input"),this.sizer=document.createElement("div"),this.pasting=!1,this.placeholder=null,this.data=null,this.settings.placeholder&&(this.placeholder=document.createElement("span")),"string"==typeof b&&(this.container=document.getElementById(b)),this._id=0,this._closeEvents=[],this._closeButtons=[],this._setMeasurements(),this._setupTextarea(),this._attachEvents()};return n.prototype._setMeasurements=function(){this.measurements.container.rect=this.container.getBoundingClientRect(),this.measurements.container.style=window.getComputedStyle(this.container);var a=this.measurements.container.style,b=parseInt(a["padding-left"]||a.paddingLeft,10),c=parseInt(a["padding-right"]||a.paddingRight,10),d=parseInt(a["border-left-width"]||a.borderLeftWidth,10),e=parseInt(a["border-right-width"]||a.borderRightWidth,10);this.measurements.container.padding=b+c+d+e},n.prototype._setupTextarea=function(){var a;if(this.list.className="taggle_list",this.input.type="text",this.input.style.paddingLeft=0,this.input.style.paddingRight=0,this.input.className="taggle_input",this.input.tabIndex=this.settings.tabIndex,this.sizer.className="taggle_sizer",this.settings.tags.length)for(var b=0,c=this.settings.tags.length;b<c;b++){var d=this._createTag(this.settings.tags[b]);this.list.appendChild(d)}this.placeholder&&(this.placeholder.style.opacity=0,this.placeholder.classList.add("taggle_placeholder"),this.container.appendChild(this.placeholder),f(this.placeholder,this.settings.placeholder),this.settings.tags.length||this._showPlaceholder());var e=this.settings.inputFormatter(this.input);e&&(this.input=e),this.inputLi.appendChild(this.input),this.list.appendChild(this.inputLi),this.container.appendChild(this.list),this.container.appendChild(this.sizer),a=window.getComputedStyle(this.input).fontSize,this.sizer.style.fontSize=a},n.prototype._attachEvents=function(){function a(){b.input.focus()}var b=this;return!this._eventsAttached&&(this._eventsAttached=!0,this.settings.focusInputOnContainerClick&&(this._handleContainerClick=a.bind(this),c(this.container,"click",this._handleContainerClick)),this._handleFocus=this._focusInput.bind(this),this._handleBlur=this._blurEvent.bind(this),this._handleKeydown=this._keydownEvents.bind(this),this._handleKeyup=this._keyupEvents.bind(this),c(this.input,"focus",this._handleFocus),c(this.input,"blur",this._handleBlur),c(this.input,"keydown",this._handleKeydown),c(this.input,"keyup",this._handleKeyup),!0)},n.prototype._detachEvents=function(){if(!this._eventsAttached)return!1;var a=this;return this._eventsAttached=!1,d(this.container,"click",this._handleContainerClick),d(this.input,"focus",this._handleFocus),d(this.input,"blur",this._handleBlur),d(this.input,"keydown",this._handleKeydown),d(this.input,"keyup",this._handleKeyup),this._closeButtons.forEach(function(b,c){var e=a._closeEvents[c];d(b,"click",e)}),!0},n.prototype._fixInputWidth=function(){var a,b,c,d,e;this._setMeasurements(),this._setInputWidth(),b=this.input.getBoundingClientRect(),c=this.measurements.container.rect,a=c.width,a||(a=c.right-c.left),d=b.left-c.left,e=this.measurements.container.padding,this._setInputWidth(Math.floor(a-d-e))},n.prototype._canAdd=function(a,b){if(!b)return!1;var c=this.settings.maxTags;if(null!==c&&c<=this.getTagValues().length)return!1;if(this.settings.onBeforeTagAdd(a,b)===!1)return!1;if(!this.settings.allowDuplicates&&this._hasDupes(b))return!1;var d=this.settings.preserveCase,e=this.settings.allowedTags;if(e.length&&!this._tagIsInArray(b,e,d))return!1;var f=this.settings.disallowedTags;return!f.length||!this._tagIsInArray(b,f,d)},n.prototype._tagIsInArray=function(a,b,c){if(c)return b.indexOf(a)!==-1;var d=[].slice.apply(b).map(function(a){return a.toLowerCase()});return d.indexOf(a)!==-1},n.prototype._add=function(a,b){var c=this,d=b||"";"string"!=typeof b&&(d=e(this.input.value));var f=this.settings.delimiter||this.settings.delimeter;d.split(f).map(function(a){return c._formatTag(a)}).forEach(function(b){if(c._canAdd(a,b)){var d=c._createTag(b),e=c.list.children,f=e[e.length-1];c.list.insertBefore(d,f),b=c.tag.values[c.tag.values.length-1],c.settings.onTagAdd(a,b),c.input.value="",c._fixInputWidth(),c._focusInput()}})},n.prototype._checkLastTag=function(a){a=a||window.event;var b=this.container.querySelectorAll(".taggle"),c=b[b.length-1],d="taggle_hot",e=this.input.classList.contains("taggle_back");""!==this.input.value||a.keyCode!==i||e?c.classList.contains(d)&&c.classList.remove(d):c.classList.contains(d)?(this.input.classList.add("taggle_back"),this._remove(c,a),this._fixInputWidth(),this._focusInput()):c.classList.add(d)},n.prototype._setInputWidth=function(a){this.input.style.width=(a||10)+"px"},n.prototype._hasDupes=function(a){var b,c=this.tag.values.indexOf(a),d=this.container.querySelector(".taggle_list");if(this.settings.duplicateTagClass){b=d.querySelectorAll("."+this.settings.duplicateTagClass);for(var e=0,f=b.length;e<f;e++)b[e].classList.remove(this.settings.duplicateTagClass)}return c>-1&&(this.settings.duplicateTagClass&&d.childNodes[c].classList.add(this.settings.duplicateTagClass),!0)},n.prototype._isConfirmKey=function(a){var b=!1;return this.settings.submitKeys.indexOf(a)>-1&&(b=!0),b},n.prototype._focusInput=function(){this._fixInputWidth(),this.container.classList.contains(this.settings.containerFocusClass)||this.container.classList.add(this.settings.containerFocusClass),this.placeholder&&(this.placeholder.style.opacity=0)},n.prototype._blurEvent=function(a){if(this.container.classList.contains(this.settings.containerFocusClass)&&this.container.classList.remove(this.settings.containerFocusClass),this.settings.saveOnBlur){if(a=a||window.event,this._listenForEndOfContainer(),""!==this.input.value)return void this._confirmValidTagEvent(a);this.tag.values.length&&this._checkLastTag(a)}else this.settings.clearOnBlur&&(this.input.value="",this._setInputWidth());this.tag.values.length||this.input.value||this._showPlaceholder()},n.prototype._keydownEvents=function(a){a=a||window.event;var b=a.keyCode;return this.pasting=!1,this._listenForEndOfContainer(),86===b&&a.metaKey&&(this.pasting=!0),this._isConfirmKey(b)&&""!==this.input.value?void this._confirmValidTagEvent(a):void(this.tag.values.length&&this._checkLastTag(a))},n.prototype._keyupEvents=function(a){a=a||window.event,this.input.classList.remove("taggle_back"),f(this.sizer,this.input.value),this.pasting&&""!==this.input.value&&(this._add(a),this.pasting=!1)},n.prototype._confirmValidTagEvent=function(a){a=a||window.event,a.preventDefault?a.preventDefault():a.returnValue=!1,this._add(a)},n.prototype._listenForEndOfContainer=function(){var a=this.sizer.getBoundingClientRect().width,b=this.measurements.container.rect.width-this.measurements.container.padding,c=parseInt(this.sizer.style.fontSize,10);a+1.5*c>parseInt(this.input.style.width,10)&&(this.input.style.width=b+"px")},n.prototype._createTag=function(a){var b=document.createElement("li"),d=document.createElement("button"),e=document.createElement("input"),g=document.createElement("span");a=this._formatTag(a),d.innerHTML="&times;",d.className="close",d.type="button";var h=this._remove.bind(this,d);c(d,"click",h),f(g,a),g.className="taggle_text",b.className="taggle "+this.settings.additionalTagClasses,e.type="hidden",e.value=a,e.name=this.settings.hiddenInputName,b.appendChild(g),b.appendChild(d),b.appendChild(e);var i=this.settings.tagFormatter(b);if("undefined"!=typeof i&&(b=i),!(b instanceof HTMLElement)||"LI"!==b.tagName)throw new Error("tagFormatter must return an li element");return this.settings.attachTagId&&(this._id+=1,a={text:a,id:this._id}),this.tag.values.push(a),this.tag.elements.push(b),this._closeEvents.push(h),this._closeButtons.push(d),b},n.prototype._showPlaceholder=function(){this.placeholder&&(this.placeholder.style.opacity=1)},n.prototype._remove=function(a,b){function c(c){if(!c){var f=h._closeEvents[g],i=h._closeButtons[g];d(i,"click",f),a.parentNode.removeChild(a),h.tag.elements.splice(g,1),h.tag.values.splice(g,1),h.settings.onTagRemove(b,e),h._focusInput()}}var e,f,g,h=this;"li"!==a.tagName.toLowerCase()&&(a=a.parentNode),f="a"===a.tagName.toLowerCase()?a.parentNode:a,g=this.tag.elements.indexOf(f),e=this.tag.values[g];var i=this.settings.onBeforeTagRemove(b,e,c);i&&c()},n.prototype._formatTag=function(a){return this.settings.preserveCase?a:a.toLowerCase()},n.prototype.getTags=function(){return{elements:this.getTagElements(),values:this.getTagValues()}},n.prototype.getTagElements=function(){return this.tag.elements},n.prototype.getTagValues=function(){return[].slice.apply(this.tag.values)},n.prototype.getInput=function(){return this.input},n.prototype.getContainer=function(){return this.container},n.prototype.add=function(a){var c=b(a);if(c)for(var d=0,e=a.length;d<e;d++)"string"==typeof a[d]&&this._add(null,a[d]);else this._add(null,a);return this},n.prototype.remove=function(a,b){for(var c=this.tag.values.length-1,d=!1;c>-1;){var e=this.tag.values[c];if(this.settings.attachTagId&&(e=e.text),e===a&&(d=!0,this._remove(this.tag.elements[c])),d&&!b)break;c--}return this},n.prototype.removeAll=function(){for(var a=this.tag.values.length-1;a>=0;a--)this._remove(this.tag.elements[a]);return this._showPlaceholder(),this},n.prototype.setOptions=function(b){return this.settings=a({},this.settings,b||{}),this},n.prototype.enable=function(){var a=[].slice.call(this.container.querySelectorAll("button")),b=[].slice.call(this.container.querySelectorAll("input"));return a.concat(b).forEach(function(a){a.removeAttribute("disabled")}),this},n.prototype.disable=function(){var a=[].slice.call(this.container.querySelectorAll("button")),b=[].slice.call(this.container.querySelectorAll("input"));return a.concat(b).forEach(function(a){a.setAttribute("disabled","")}),this},n.prototype.setData=function(a){return this.data=a,this},n.prototype.getData=function(){return this.data},n.prototype.attachEvents=function(){var a=this,b=this._attachEvents();return b&&this._closeButtons.forEach(function(b,d){var e=a._closeEvents[d];c(b,"click",e)}),this},n.prototype.removeEvents=function(){return this._detachEvents(),this},n});